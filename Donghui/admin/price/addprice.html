
<div class="bjui-pageContent tableContent">
    <form action="ajax.ashx?action=addprice" id="j_product_form" data-toggle="validate" data-alertmsg="false">
        <input type="hidden" name="custom.id" value="edce142bc2ed4ec6b623aacaf602a4de">
        <table class="table table-condensed table-hover" width="100%">
            <tbody>
                <tr>
                    <td>
                        <label for="j_custom_name" class="control-label x85">套餐名称：</label>
                        <input type="text" name="pname" id="p_price_name" value="" data-rule="required" size="15">
                        <input type="hidden" id="pricePid" name="pricePid" value="" />
                    </td>
                    <td>    </td>
                    <td>   </td>
                    <td> <button type="button" class="btn-green" data-toggle="tableditadd" data-target="#addpriceitem" data-num="1" data-icon="plus">添加套餐项目</button>&nbsp;   </td>
                </tr>
                <tr>
                    <td colspan="4">
                        <table id="addpriceitem" class="table table-bordered table-hover table-striped table-top" data-toggle="tabledit" data-initnum="10" data-action="ajax.ashx?action=addpriceitem1" data-single-noindex="true">
                            <thead>
                                <tr>
                                    <th title="项目名">
                                         <input type="text" value="" placeholder="请输入项目名" size="10" name="priceItemName" id="priceItemName[#index#]" data-rule="required"/> 
                               
                                    </th>
                                    <th title="价格(元)"><input type="text" name="price" value="1" size="4" data-toggle="spinner" id="t_price[#index#]" data-min="1" data-step="10" data-rule="required,integer"  /></th>
                                    <th title="操作">
                                        <a href="javascript:;" class="btn btn-green" indexid="[#index#]" onclick="pirce_item_dosave(this)">保存</a>
                                        <a href="javascript:;" class="btn btn-red row-del" data-confirm-msg="确定要删除该行信息吗？">删除</a> 
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>

                        </table>
                    </td>
               
                </tr>

 
            </tbody>
        </table>
    </form>
</div>
<div class="bjui-pageFooter">
    <ul>
        <li><button type="button" class="btn-close" data-icon="close">取消</button></li>
        <li><button type="button" class="btn-default" onclick="add_price_save()" data-icon="save">保存</button></li>
    </ul>
</div>
<script type="text/javascript">
    $(function () { 
        if (price_edit_id) {
            $("#p_price_name").val(price_edit_name);
            $("#pricePid").val(price_edit_id);
         
            $.ajax({
                url: "ajax.ashx?action=getpriceitemlist",
                data: { pid: price_edit_id },
                type:"post",
                success: function (r) { 
                    var rd = JSON.parse(r)["d"];
                    var html = [];
                    for (var i = 0; i < rd.length; i++) {
                        d = rd[i]; 
                        html.push("<tr> <td> " + d.name + "</td>");
                        html.push("  <td>" + d.itemPrice + " </td>"); 
                        html.push(' <td>   '); 
                        html.push('<a href="ajax.ashx?action=deletepriceitem&id='+ d.id +'" data-toggle="doajax" class="btn btn-red row-del" data-confirm-msg="确定要删除该行信息吗？">删除</a></td> </tr>'); 
                    }
                    $("#addpriceitem tbody").empty().append(html.join('')); 
                  
                   // price_edit_id = undefined;
                }, error: function () {
                    console.log("error");
                }
            });
        }
      
    });
    var price_item_list_temp =[];
    function pirce_item_dosave(_this) {
        console.log(".....");
        var rowindex = $(_this).attr("indexid");
        var obj = new Object();
        obj.itemName = $("#priceItemName" + rowindex).val()
        obj.itemPrice = $("#t_price" + rowindex).val()
        obj.pid = $("#pricePid").val();
        price_item_list_temp.push(obj);
       
    }
    function add_price_save() {
        var postData = {};
        if (price_item_list_temp.length > 0) {
            postData.items = price_item_list_temp;
        }
        postData.name = $("#p_price_name").val();
        $.ajax({
            url: "ajax.ashx?action=addprice",
            data: postData,
            type: "post",
            success: function (r) {
                console.log(r);
            }, error: function () {
                console.log("error");
            }
        });
        
    }
</script>